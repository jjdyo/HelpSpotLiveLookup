server {
    listen 80;
    server_name your-server.example.com;

    root /var/www/livelookup;
    index index.php;

    access_log /var/log/nginx/livelookup_access.log;
    error_log /var/log/nginx/livelookup_error.log;

    # Only this one PHP script should be callable
    location = /livelookup.php {
        # Referer-based restriction (adjust to your real HelpSpot domain)
        valid_referers none blocked jaxonhelpspot.helpspot.com *.jaxonhelpspot.helpspot.com;
        if ($invalid_referer) {
            return 403;
        }

        include snippets/fastcgi-php.conf;

        # Use the actual PHP-FPM socket you found with ls /run/php
        fastcgi_pass unix:/run/php/php8.3-fpm.sock;

        # Custom PHP settings just for this location
        fastcgi_param PHP_VALUE "error_log=/var/log/nginx/php_errors.log";
    }

    # Deny access to any other PHP
    location ~ \.php$ {
        deny all;
    }

    # Deny hidden files (.git, .env, etc.)
    location ~ /\. {
        deny all;
    }
}

server {
    listen 443 ssl http2;
    server_name your-server.example.com;

    ssl_certificate /etc/ssl/certs/your-cert.pem;
    ssl_certificate_key /etc/ssl/private/your-key.pem;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    root /var/www/livelookup;
    index index.php;

    access_log /var/log/nginx/livelookup_ssl_access.log;
    error_log /var/log/nginx/livelookup_ssl_error.log;

    location = /livelookup.php {
        valid_referers none blocked jaxonhelpspot.helpspot.com *.jaxonhelpspot.helpspot.com;
        if ($invalid_referer) {
            return 403;
        }

        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/run/php/php8.3-fpm.sock;

        fastcgi_param PHP_VALUE "error_log=/var/log/nginx/php_errors.log";
    }

    location ~ \.php$ {
        deny all;
    }

    location ~ /\. {
        deny all;
    }
}
